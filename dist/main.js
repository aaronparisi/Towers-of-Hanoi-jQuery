(()=>{"use strict";function t(){this.containers=[[],[],[]],this.numDiscs=8,this.setupDiscs()}function e(){this.board=new t,this.moves=[],this.moveIdx=-1,this.score=0}function o(t){this.gameView=t,this.isThinking=!1}function i(){this.$scoreSlot.html(this.game.score)}function n(){return this.game.hasMovesToRedo()}function s(){this.resetGame(),this.demoTimeout,this.demoDelay=10}t.prototype.setupDiscs=function(){for(let t=0;t<this.numDiscs;t++)this.addToBottom(t,0)},t.prototype.isValidMove=function(t,e){return!!this.containerIsEmpty(e)||this.containerTopDisc(e)>t},t.prototype.moveDisc=function(t,e){let o=this.removeFromTop(t);return this.addToTop(o,e),o},t.prototype.addToTop=function(t,e){this.containers[e].unshift(t)},t.prototype.addToBottom=function(t,e){this.containers[e].push(t)},t.prototype.removeFromTop=function(t){return this.containers[t].shift()},t.prototype.findContainerByDiscID=function(t){let e;return this.containers.forEach(((o,i)=>{o.includes(t)&&(e=i)})),e},t.prototype.containerHasDisc=function(t,e){return this.containers[e].includes(t)},t.prototype.containerTopDisc=function(t){return this.containers[t][0]},t.prototype.containerBottomDisc=function(t){let e=this.containers[t];return e[e.length-1]},t.prototype.discBelowMe=function(t,e){let o,i=this.containerDiscCount(e),n=this.containers[e];for(let e=0;e<i;e++)n[e]===t&&(o=n[e+1]);return o},t.prototype.containerIsEmpty=function(t){return 0===this.containers[t].length},t.prototype.containerIsCompatible=function(t,e){return this.containerIsEmpty(e)||this.containerTopDisc(e)>t},t.prototype.containerDiscCount=function(t){return this.containers[t].length},e.prototype.isValidMove=function(t,e){return this.board.isValidMove(t,e)},e.prototype.findContainerByDiscID=function(t){return this.board.findContainerByDiscID(t)},e.prototype.containerHasDisc=function(t,e){return this.board.containerHasDisc(t,e)},e.prototype.containerTopDisc=function(t){return this.board.containerTopDisc(t)},e.prototype.containerBottomDisc=function(t){return this.board.containerBottomDisc(t)},e.prototype.discBelowMe=function(t,e){return this.board.discBelowMe(t,e)},e.prototype.containerIsEmpty=function(t){return this.board.containerIsEmpty(t)},e.prototype.containerIsCompatible=function(t,e){return this.board.containerIsCompatible(t,e)},e.prototype.containerDiscCount=function(t){return this.board.containerDiscCount(t)},e.prototype.isOver=function(){return 8===this.board.containerDiscCount(2)},e.prototype.moveDisc=function(t,e){this.lopOffMoves(),this.board.moveDisc(t,e),this.score++,this.moves.push({discID:this.board.containerTopDisc(e),sourceID:t,destinationID:e}),this.moveIdx++},e.prototype.lopOffMoves=function(){for(;this.moveIdx<this.moves.length-1;)this.moves.pop()},e.prototype.undoMove=function(){let t=this.moves[this.moveIdx],e=t.destinationID,o=t.sourceID,i=this.board.moveDisc(e,o);return this.moveIdx--,this.score--,{targetID:o,discID:i}},e.prototype.getCurrentMove=function(){return this.moves[this.moveIdx]},e.prototype.redoMove=function(){let t=this.moves[this.moveIdx+1],e=t.sourceID,o=t.destinationID,i=this.board.moveDisc(e,o);return this.moveIdx++,this.score++,{targetID:o,discID:i}},e.prototype.hasMovesToUndo=function(){return this.moveIdx>=0},e.prototype.hasMovesToRedo=function(){return this.moveIdx<this.moves.length-1},o.prototype.startThinking=function(){this.isThinking=!0},o.prototype.stopThinking=function(){this.isThinking=!1},o.prototype.getThirdTower=function(t,e){return[0,1,2].filter((o=>o!==t&&o!==e))[0]},o.prototype.discAtTarget=function(t,e){return this.gameView.containerHasDisc(t,e)},o.prototype.readyToMove=function(t,e,o){return this.gameView.containerTopDisc(o)===t&&this.gameView.containerIsCompatible(t,e)},o.prototype.getDemoMove=function(t,e){let o=this.gameView.findContainerByDiscID(t),i=this.getThirdTower(e,o);return this.discAtTarget(t,e)?this.getDemoMove(t-1,e):this.readyToMove(t,e,o)?new Promise(((i,n)=>{i({discID:t,fromContID:o,toContID:e})})):this.getDemoMove(t-1,i)},s.prototype.genTowerImgDiv=function(){return $("<div></div>").addClass("tower-image").append('<div class="stalk"></div>').append('<div class="base"></div>')},s.prototype.genDiscContainerDiv=function(t){return $("<div></div>").addClass("disc-container").attr("id",`disc-container${t}`).data("containerID",t)},s.prototype.updateScoreView=i,s.prototype.updateScoreView=i,s.prototype.gameIsOver=function(){return this.game.isOver()},s.prototype.gameOverActions=function(){this.updateUndoRedoButtons(),$(".demo").attr("disabled",!0),$(".reset").attr("disabled",!1)},s.prototype.resetGame=function(){this.game=new e,this.AIPlayer=new o(this),this.$boardEl=$(".board"),this.$resetButton=$(".reset"),this.$undoButton=$("#undo"),this.$redoButton=$("#redo"),this.$demoButton=$(".demo"),this.$scoreSlot=$(".score"),$("button").not(this.$demoButton).attr("disabled",!0),$(".demo").html("Run Demo").attr("disabled",!1),$("body").removeClass("disc-selected"),this.$boardEl.html(""),this.updateScoreView(),this.setupView(),this.bindEvents()},s.prototype.setupView=function(){for(let t=0;t<3;t++){let e=$("<div></div>").addClass("tower").attr("id",`tower${t}`).data("towerID",t),o=this.genTowerImgDiv(),i=this.genDiscContainerDiv(t);e.append(i),e.append(o),this.$boardEl.append(e)}for(let t=0;t<8;t++){let e=15,o=2,i=$("<div></div>").addClass("disc").attr("id",`disc${t}`).data("discID",t);i.width(12*(t+1)+3+"%"),i.css("backgroundColor",`rgb(${252-(t+o)*e}, ${231-(t+o)*e}, ${92-(t+o)*e})`),$("#disc-container0").append(i)}},s.prototype.bindEvents=function(){let t=this;$("*").off("click"),$("*").off("mouseenter"),$("*").off("mouseleave"),$(".disc-container").on({mouseenter:function(e){t.discIsSelected()||$(e.currentTarget).addClass("hovered-disc")},mouseleave:function(t){$(t.currentTarget).removeClass("hovered-disc")},click:function(e){t.toggleDiscSelect($(e.currentTarget))}},".disc:first-child:not(.disc-shadow)"),$(".tower").on({mouseenter:function(e){t.toggleTargetHover($(e.currentTarget))},mouseleave:function(e){t.toggleTargetHover($(e.currentTarget))},click:function(e){t.targetSelected($(e.currentTarget))}},".valid-target"),$(".reset").on("click",(function(e){t.resetGame()})),$("#undo").on("click",(function(e){t.undoMove()})),$("#redo").on("click",(function(e){t.redoMove()})),$(".demo").on("click",(function(e){t.toggleDemo()}))},s.prototype.getContainerByID=function(t){return $(".disc-container").filter(((e,o)=>$(o).data("containerID")===t))},s.prototype.getDiscByID=function(t){return $(".disc").filter(((e,o)=>$(o).data("discID")===t))},s.prototype.isValidMove=function(t,e){return this.game.isValidMove(t,e)},s.prototype.findContainerByDiscID=function(t){return this.game.findContainerByDiscID(t)},s.prototype.containerHasDisc=function(t,e){return this.game.containerHasDisc(t,e)},s.prototype.containerTopDisc=function(t){return this.game.containerTopDisc(t)},s.prototype.containerBottomDisc=function(t){return this.game.containerBottomDisc(t)},s.prototype.discBelowMe=function(t,e){return this.game.discBelowMe(t,e)},s.prototype.discInFinalRestingPlace=function(t,e){return 2===e&&(7===t&&this.containerBottomDisc(e)===t||this.discBelowMe(t,e)===t+1&&this.discInFinalRestingPlace(t+1,e))},s.prototype.containerIsEmpty=function(t){return this.game.containerIsEmpty(t)},s.prototype.containerIsCompatible=function(t,e){return this.game.containerIsCompatible(t,e)},s.prototype.containerDiscCount=function(t){return this.game.containerDiscCount(t)},s.prototype.isOver=function(){return this.game.isOver()},s.prototype.hasMovesToUndo=function(){return this.game.hasMovesToUndo()},s.prototype.hasMovesToRedo=n,s.prototype.targetSelected=function(t){let e=$(".selected-disc"),o=e.parent();this.completeMove(o,t,e),t.parent().removeClass("hovered-valid-target"),$(".tower").removeClass("valid-target"),this.toggleDiscSelect($(".selected-disc"))},s.prototype.completeMove=function(t,e,o){this.game.moveDisc(t.data("containerID"),e.data("containerID")),this.moveDisc(o,e)},s.prototype.moveDisc=function(t,e){let o=t.data("discID");e.prepend(t),this.updateScoreView(),this.updateUndoRedoButtons(),this.$resetButton.attr("disabled",!1),this.$demoButton.attr("disabled",!1).html("Run Demo"),this.discInFinalRestingPlace(t.data("discID"),e.data("containerID"))?t.css("backgroundColor",`rgb(${187-16*(o+2)}, ${225-16*(o+2)}, ${207-16*(o+2)})`):t.css("backgroundColor",`rgb(${252-15*(o+2)}, ${231-15*(o+2)}, ${92-15*(o+2)})`),this.game.isOver()?this.gameOverActions():$("*").removeClass("winning-tower")},s.prototype.toggleTargetHover=function(t){t.children().first().toggleClass("invisible"),t.parent().toggleClass("hovered-valid-target")},s.prototype.toggleDiscSelect=function(t){t.toggleClass("selected-disc"),$("body").toggleClass("disc-selected"),this.toggleValidTargets()},s.prototype.toggleValidTargets=function(){let t=$(".selected-disc").first();t.length?$(".disc-container").filter(((e,o)=>this.game.board.isValidMove(t.data("discID"),$(o).data("containerID")))).addClass("valid-target").prepend(this.genDiscShadow()):($(".disc-container").removeClass("valid-target"),$(".disc-shadow").remove())},s.prototype.genDiscShadow=function(){let t=$(".selected-disc");return $("<div></div>").addClass("disc disc-shadow invisible").width(t.outerWidth())},s.prototype.discIsSelected=function(){return 1===$(".selected-disc").length},s.prototype.undoMove=function(){this.undoRedo(this.game.undoMove())},s.prototype.redoMove=function(){this.undoRedo(this.game.redoMove())},s.prototype.updateUndoRedoButtons=function(){this.$undoButton.attr("disabled",!this.game.hasMovesToUndo()),this.$redoButton.attr("disabled",!this.game.hasMovesToRedo())},s.prototype.undoRedo=function(t){let e=this.getContainerByID(t.targetID),o=this.getDiscByID(t.discID);return this.moveDisc(o,e),Promise.resolve()},s.prototype.waitDelay=function(){return new Promise(((t,e)=>{this.demoTimeout=setTimeout((()=>{t()}),this.demoDelay)}))},s.prototype.showRunningDemoView=function(){$(".demo").html("Pause Demo").attr("disabled",!1),$(".reset").attr("disabled",!0),$(".takback").attr("disabled",!0)},s.prototype.showPausedDemoView=function(){$(".demo").html("Run Demo").attr("disabled",!1),$(".reset").attr("disabled",!1),this.updateUndoRedoButtons()},s.prototype.pauseDemo=function(){clearTimeout(this.demoTimeout),this.AIPlayer.stopThinking(),this.showPausedDemoView()},s.prototype.startDemo=function(){this.AIPlayer.startThinking(),this.showRunningDemoView(),this.runDemo()},s.prototype.endDemo=function(){clearTimeout(this.demoTimeout),this.AIPlayer.stopThinking(),this.gameOverActions()},s.prototype.runDemo=function(){this.game.hasMovesToRedo()?this.redoDemoMove().then((()=>{this.runDemo()})):this.runAILoop()},s.prototype.hasMovesToRedo=n,s.prototype.redoDemoMove=function(){return new Promise(((t,e)=>{this.waitDelay().then((()=>this.redoMove())).then((()=>{t()})).catch((t=>{console.log(`error redoing moves: ${t.message}`)}))}))},s.prototype.runAILoop=function(){this.isOver()?this.endDemo():this.waitDelay().then((()=>this.AIPlayer.getDemoMove(7,2))).then((t=>{let e=this.getContainerByID(t.toContID),o=this.getDiscByID(t.discID),i=this.getContainerByID(t.fromContID);this.completeMove(i,e,o)})).then((()=>{this.runAILoop()}))},s.prototype.toggleDemo=function(){this.AIPlayer.isThinking?this.pauseDemo():this.startDemo()},s.prototype.isNotTopDisc=function(t){return this.game.board.containers[0][0].discID!==t&&this.game.board.containers[1][0].discID!==t&&this.game.board.containers[2][0].discID!==t},s.prototype.hasNoMoves=function(t){return this.game.board.containers[0][0].discID>=t&&this.game.board.containers[1][0].discID>=t&&this.game.board.containers[2][0].discID>=t},s.prototype.dumbToMove=function(t){},s.prototype.myDisableToggle=function(t,...e){e.forEach((e=>{e.attr("disabled",t)}))},$((()=>{new s(new e)}))})();